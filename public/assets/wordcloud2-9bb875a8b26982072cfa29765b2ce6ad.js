"use strict";window.setImmediate||(window.setImmediate=function(){return window.msSetImmediate||window.webkitSetImmediate||window.mozSetImmediate||window.oSetImmediate||function(){if(!window.postMessage||!window.addEventListener)return null;var t=[void 0],e="zero-timeout-message",r=function(r){var a=t.length;return t.push(r),window.postMessage(e+a.toString(36),"*"),a};return window.addEventListener("message",function(r){if("string"==typeof r.data&&r.data.substr(0,e.length)===e){r.stopImmediatePropagation();var a=parseInt(r.data.substr(e.length),36);t[a]&&(t[a](),t[a]=void 0)}},!0),window.clearImmediate=function(e){t[e]&&(t[e]=void 0)},r}()||function(t){window.setTimeout(t,0)}}()),window.clearImmediate||(window.clearImmediate=function(){return window.msClearImmediate||window.webkitClearImmediate||window.mozClearImmediate||window.oClearImmediate||function(t){window.clearTimeout(t)}}()),function(t){var e=function(){var t=document.createElement("canvas");if(!t||!t.getContext)return!1;var e=t.getContext("2d");return e.getImageData&&e.fillText&&Array.prototype.some&&Array.prototype.push?!0:!1}(),r=function(){if(e){for(var t,r,a=document.createElement("canvas").getContext("2d"),o=20;o;){if(a.font=o.toString(10)+"px sans-serif",a.measureText("\uff37").width===t&&a.measureText("m").width===r)return o+1;t=a.measureText("\uff37").width,r=a.measureText("m").width,o--}return 0}}(),a=function(t){for(var e,r,a=t.length;a;e=Math.floor(Math.random()*a),r=t[--a],t[a]=t[e],t[e]=r);return t},o=function(t,o){if(e){Array.isArray(t)||(t=[t]),t.forEach(function(e,r){if("string"==typeof e){if(t[r]=document.getElementById(e),!t[r])throw"The element id specified is not found."}else if(!e.tagName&&!e.appendChild)throw"You must pass valid HTML elements, or ID of the element."});var i={list:[],fontFamily:'"Trebuchet MS", "Heiti TC", "\u5fae\u8edf\u6b63\u9ed1\u9ad4", "Arial Unicode MS", "Droid Fallback Sans", sans-serif',fontWeight:"normal",color:"random-dark",minSize:0,weightFactor:1,clearCanvas:!0,backgroundColor:"#fff",gridSize:8,origin:null,drawMask:!1,maskColor:"rgba(255,0,0,0.3)",maskGapWidth:.3,wait:0,abortThreshold:0,abort:function(){},minRotation:-Math.PI/2,maxRotation:Math.PI/2,shuffle:!0,rotateRatio:.1,shape:"circle",ellipticity:.65,hover:null,click:null};if(o)for(var n in o)n in i&&(i[n]=o[n]);if("function"!=typeof i.weightFactor){var f=i.weightFactor;i.weightFactor=function(t){return t*f}}if("function"!=typeof i.shape)switch(i.shape){case"circle":default:i.shape="circle";break;case"cardioid":i.shape=function(t){return 1-Math.sin(t)};break;case"diamond":case"square":i.shape=function(t){var e=t%(2*Math.PI/4);return 1/(Math.cos(e)+Math.sin(e))};break;case"triangle-forward":i.shape=function(t){var e=t%(2*Math.PI/3);return 1/(Math.cos(e)+Math.sqrt(3)*Math.sin(e))};break;case"triangle":case"triangle-upright":i.shape=function(t){var e=(t+3*Math.PI/2)%(2*Math.PI/3);return 1/(Math.cos(e)+Math.sqrt(3)*Math.sin(e))};break;case"pentagon":i.shape=function(t){var e=(t+.955)%(2*Math.PI/5);return 1/(Math.cos(e)+.726543*Math.sin(e))};break;case"star":i.shape=function(t){var e=(t+.955)%(2*Math.PI/10);return(t+.955)%(2*Math.PI/5)-2*Math.PI/10>=0?1/(Math.cos(2*Math.PI/10-e)+3.07768*Math.sin(2*Math.PI/10-e)):1/(Math.cos(e)+3.07768*Math.sin(e))}}i.gridSize=Math.max(Math.floor(i.gridSize),4);var l,s,d,c,h,u,m,v=i.gridSize,g=v-i.maskGapWidth,w=Math.abs(i.maxRotation-i.minRotation),M=Math.min(i.maxRotation,i.minRotation);switch(i.color){case"random-dark":m=function(){return"rgb("+Math.floor(128*Math.random()).toString(10)+","+Math.floor(128*Math.random()).toString(10)+","+Math.floor(128*Math.random()).toString(10)+")"};break;case"random-light":m=function(){return"rgb("+Math.floor(128*Math.random()+128).toString(10)+","+Math.floor(128*Math.random()+128).toString(10)+","+Math.floor(128*Math.random()+128).toString(10)+")"};break;default:"function"==typeof i.color&&(m=i.color)}var p,x=!1,b=[],C=function(t){var e=t.currentTarget,r=e.getBoundingClientRect(),a=t.clientX-r.left,o=t.clientY-r.top,i=Math.floor(a*(e.width/r.width||1)/v),n=Math.floor(o*(e.height/r.height||1)/v);return b[i][n]},I=function(t){var e=C(t);if(p!==e)return p=e,e?void i.hover(e.item,e.dimension,t):void i.hover(void 0,void 0,t)},T=function(t){var e=C(t);e&&i.click(e.item,e.dimension,t)},y=[],S=function(t){if(y[t])return y[t];var e=8*t,r=e,a=[];for(0===t&&a.push([c[0],c[1],0]);r--;){var o=1;"circle"!==i.shape&&(o=i.shape(r/e*2*Math.PI)),a.push([c[0]+t*o*Math.cos(-r/e*2*Math.PI),c[1]+t*o*Math.sin(-r/e*2*Math.PI)*i.ellipticity,r/e*2*Math.PI])}return y[t]=a,a},k=function(){return i.abortThreshold>0&&(new Date).getTime()-u>i.abortThreshold},E=function(){return 0===i.rotateRatio?0:Math.random()>i.rotateRatio?0:0===w?M:M+Math.random()*w},R=function(t,e,a){var o=!1,n=i.weightFactor(e);if(n<=i.minSize)return!1;var f=1;r>n&&(f=function(){for(var t=2;r>t*n;)t+=2;return t}());var l=document.createElement("canvas"),s=l.getContext("2d",{willReadFrequently:!0});s.font=i.fontWeight+" "+(n*f).toString(10)+"px "+i.fontFamily;var d=s.measureText(t).width/f,c=Math.max(n*f,s.measureText("m").width,s.measureText("\uff37").width)/f,h=d+2*c,u=3*c,m=Math.ceil(h/v),g=Math.ceil(u/v);h=m*v,u=g*v;var w=-d/2,M=.4*-c,p=Math.ceil((h*Math.abs(Math.sin(a))+u*Math.abs(Math.cos(a)))/v),x=Math.ceil((h*Math.abs(Math.cos(a))+u*Math.abs(Math.sin(a)))/v),b=x*v,C=p*v;l.setAttribute("width",b),l.setAttribute("height",C),o&&(document.body.appendChild(l),s.save()),s.scale(1/f,1/f),s.translate(b*f/2,C*f/2),s.rotate(-a),s.font=i.fontWeight+" "+(n*f).toString(10)+"px "+i.fontFamily,s.fillStyle="#000",s.textBaseline="middle",s.fillText(t,w*f,(M+.5*n)*f);var I=s.getImageData(0,0,b,C).data;if(k())return!1;o&&(s.strokeRect(w*f,M,d*f,c*f),s.restore());for(var T,y,S,E=[],R=x,P=[p/2,x/2,p/2,x/2];R--;)for(T=p;T--;){S=v;t:{for(;S--;)for(y=v;y--;)if(I[4*((T*v+S)*b+(R*v+y))+3]){E.push([R,T]),R<P[3]&&(P[3]=R),R>P[1]&&(P[1]=R),T<P[0]&&(P[0]=T),T>P[2]&&(P[2]=T),o&&(s.fillStyle="rgba(255, 0, 0, 0.5)",s.fillRect(R*v,T*v,v-.5,v-.5));break t}o&&(s.fillStyle="rgba(0, 0, 255, 0.5)",s.fillRect(R*v,T*v,v-.5,v-.5))}}return o&&(s.fillStyle="rgba(0, 255, 0, 0.5)",s.fillRect(P[3]*v,P[0]*v,(P[1]-P[3]+1)*v,(P[2]-P[0]+1)*v)),{mu:f,occupied:E,bounds:P,gw:x,gh:p,fillTextOffsetX:w,fillTextOffsetY:M,fillTextWidth:d,fillTextHeight:c,fontSize:n}},P=function(t,e,r,a,o){for(var i=o.length;i--;){var n=t+o[i][0],f=e+o[i][1];if(n>=s||f>=d||0>n||0>f||!l[n][f])return!1}return!0},F=function(e,r,a,o,n,f,l,s,d){var c,h=a.fontSize;c=m?m(o,n,h,f,l):i.color;var u,g=a.bounds;u={x:(e+g[3])*v,y:(r+g[0])*v,w:(g[1]-g[3]+1)*v,h:(g[2]-g[0]+1)*v},t.forEach(function(t){if(t.getContext){var n=t.getContext("2d"),f=a.mu;n.save(),n.scale(1/f,1/f),n.font=i.fontWeight+" "+(h*f).toString(10)+"px "+i.fontFamily,n.fillStyle=c,n.translate((e+a.gw/2)*v*f,(r+a.gh/2)*v*f),0!==s&&n.rotate(-s),n.textBaseline="middle",n.fillText(o,a.fillTextOffsetX*f,(a.fillTextOffsetY+.5*h)*f),n.restore()}else{var l=document.createElement("span"),u="";u="rotate("+-s/Math.PI*180+"deg) ",1!==a.mu&&(u+="translateX(-"+a.fillTextWidth/4+"px) scale("+1/a.mu+")");var m={position:"absolute",display:"block",font:i.fontWeight+" "+h*a.mu+"px "+i.fontFamily,left:(e+a.gw/2)*v+a.fillTextOffsetX+"px",top:(r+a.gh/2)*v+a.fillTextOffsetY+"px",width:a.fillTextWidth+"px",height:a.fillTextHeight+"px",color:c,lineHeight:h+"px",whiteSpace:"nowrap",transform:u,webkitTransform:u,msTransform:u,transformOrigin:"50% 40%",webkitTransformOrigin:"50% 40%",msTransformOrigin:"50% 40%"};l.textContent=o;for(var g in m)l.style[g]=m[g];if(d)for(var w in d)l.setAttribute(w,d[w]);t.appendChild(l)}})},z=function(e,r,a,o,i){if(!(e>=s||r>=d||0>e||0>r)){if(l[e][r]=!1,a){var n=t[0].getContext("2d");n.fillRect(e*v,r*v,g,g)}x&&(b[e][r]={item:i,dimension:o})}},L=function(e,r,a,o,n,f){var l,s=n.occupied,d=i.drawMask;d&&(l=t[0].getContext("2d"),l.save(),l.fillStyle=i.maskColor);var c;if(x){var h=n.bounds;c={x:(e+h[3])*v,y:(r+h[0])*v,w:(h[1]-h[3]+1)*v,h:(h[2]-h[0]+1)*v}}for(var u=s.length;u--;)z(e+s[u][0],r+s[u][1],d,c,f);d&&l.restore()},W=function(t){var e,r,o;Array.isArray(t)?(e=t[0],r=t[1]):(e=t.word,r=t.weight,o=t.attributes);var n=E(),f=R(e,r,n);if(!f)return!1;if(k())return!1;var l=f.bounds;if(l[1]-l[3]+1>s||l[2]-l[0]+1>d)return!1;for(var c=h+1,u=function(a){var i=Math.floor(a[0]-f.gw/2),l=Math.floor(a[1]-f.gh/2),s=f.gw,d=f.gh;return P(i,l,s,d,f.occupied)?(F(i,l,f,e,r,h-c,a[2],n,o),L(i,l,s,d,f,t),!0):!1};c--;){var m=S(h-c);i.shuffle&&(m=[].concat(m),a(m));var v=m.some(u);if(v)return!0}return!1},A=function(e,r,a){return r?!t.some(function(t){var o=document.createEvent("CustomEvent");return o.initCustomEvent(e,!0,r,a||{}),!t.dispatchEvent(o)},this):void t.forEach(function(t){var o=document.createEvent("CustomEvent");o.initCustomEvent(e,!0,r,a||{}),t.dispatchEvent(o)},this)},O=function(){var e=t[0];if(e.getContext)s=Math.floor(e.width/v),d=Math.floor(e.height/v);else{var r=e.getBoundingClientRect();s=Math.floor(r.width/v),d=Math.floor(r.height/v)}if(A("wordcloudstart",!0)){c=i.origin?[i.origin[0]/v,i.origin[1]/v]:[s/2,d/2],h=Math.floor(Math.sqrt(s*s+d*d)),l=[];var a,o,n;if(!e.getContext||i.clearCanvas)for(t.forEach(function(t){if(t.getContext){var e=t.getContext("2d");e.fillStyle=i.backgroundColor,e.clearRect(0,0,s*(v+1),d*(v+1)),e.fillRect(0,0,s*(v+1),d*(v+1))}else t.textContent="",t.style.backgroundColor=i.backgroundColor}),a=s;a--;)for(l[a]=[],o=d;o--;)l[a][o]=!0;else{var f=document.createElement("canvas").getContext("2d");f.fillStyle=i.backgroundColor,f.fillRect(0,0,1,1);var m=f.getImageData(0,0,1,1).data,g=e.getContext("2d").getImageData(0,0,s*v,d*v).data;a=s;for(var w,M;a--;)for(l[a]=[],o=d;o--;){M=v;t:for(;M--;)for(w=v;w--;)for(n=4;n--;)if(g[4*((o*v+M)*s*v+(a*v+w))+n]!==m[n]){l[a][o]=!1;break t}l[a][o]!==!1&&(l[a][o]=!0)}g=f=m=void 0}if(i.hover||i.click){for(x=!0,a=s+1;a--;)b[a]=[];i.hover&&e.addEventListener("mousemove",I),i.click&&e.addEventListener("click",T),e.addEventListener("wordcloudstart",function F(){e.removeEventListener("wordcloudstart",F),e.removeEventListener("mousemove",I),e.removeEventListener("click",T),p=void 0})}n=0;var C,y;0!==i.wait?(C=window.setTimeout,y=window.clearTimeout):(C=window.setImmediate,y=window.clearImmediate);var S=function(e,r){t.forEach(function(t){t.addEventListener(e,r)},this)},E=function(e,r){t.forEach(function(t){t.removeEventListener(e,r)},this)},R=function z(){E("wordcloudstart",z),y(P)};S("wordcloudstart",R);var P=C(function L(){if(n>=i.list.length)return y(P),A("wordcloudstop",!1),void E("wordcloudstart",R);u=(new Date).getTime();var t=W(i.list[n]),e=!A("wordclouddrawn",!0,{item:i.list[n],drawn:t});return k()||e?(y(P),i.abort(),A("wordcloudabort",!1),A("wordcloudstop",!1),void E("wordcloudstart",R)):(n++,void(P=C(L,i.wait)))},i.wait)}};O()}};o.isSupported=e,o.miniumFontSize=r,"function"==typeof t.define&&t.define.amd?t.define("wordcloud",[],function(){return o}):t.WordCloud=o}(window);